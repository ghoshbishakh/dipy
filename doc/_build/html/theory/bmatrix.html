

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      
      <title>The B matrix and Siemens DICOM &mdash; dipy 0.12.0dev documentation</title>
      
    <link rel="stylesheet" href="../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/main.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.12.0dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/bootstrap.min.js"></script>
      <link rel="top" title="dipy 0.12.0dev documentation" href="../index.html" /> 
    </head>
    <body role="document">
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html"><img style="max-width:100px; margin-top: -7px;"
             src="../_static/images/dipy-logo.png"></a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="../index.html">Home</a></li>
              <li><a href="../stateoftheart.html">Overview</a></li>
              <li><a href="../examples_index.html">Gallery</a></li>
              <li><a href="../installation.html">Download</a></li>
              <li><a href="../subscribe.html">Subscribe</a></li>
              <li><a href="../developers.html">Developers</a></li>
              <li><a href="../cite.html">Cite</a></li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>  
      <div class="container mainContainer">
        <div class="row">
          <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9 docCol">
            <div class="document main-doc">
              <div class="documentwrapper">
                <div class="bodywrapper">
                  <div class="body img-control" role="main">
                    
  <div class="section" id="the-b-matrix-and-siemens-dicom">
<h1>The B matrix and Siemens DICOM<a class="headerlink" href="#the-b-matrix-and-siemens-dicom" title="Permalink to this headline">¶</a></h1>
<p>This is a short note to explain the nature of the <code class="docutils literal"><span class="pre">B_matrix</span></code> found in the
Siemens private (CSA) fields of the DICOM headers of a diffusion weighted
acquisition.  We trying to explain the relationship between the <code class="docutils literal"><span class="pre">B_matrix</span></code> and
the <em>b value</em> and the <em>gradient vector</em>.  The acquisition is made with a planned
(requested) b value - say <span class="math">\(b_{req} = 1000\)</span>, and with a requested gradient
direction <span class="math">\(\mathbf{g}_{req} = [g_x, g_y, g_z]\)</span> (supposedly a unit vector).</p>
<p>Note that here we&#8217;re using <span class="math">\(\mathbf{q}\)</span> in the sense of an approximation
to a vector in <span class="math">\(q\)</span> space.  Other people use <span class="math">\(\mathbf{b}\)</span> for the same
concept, but we&#8217;ve chosen <span class="math">\(\mathbf{q}\)</span> to make the exposition clearer.</p>
<p>For some purposes we want the q vector <span class="math">\(\mathbf{q}_{actual}\)</span> which is
equal to <span class="math">\(b_{actual} . \mathbf{g}_{actual}\)</span>. We need to be aware that
<span class="math">\(b_{actual}\)</span> and <span class="math">\(\mathbf{g}_{actual}\)</span> may be different from the
<span class="math">\(b_{req}\)</span> and <span class="math">\(\mathbf{g}_{req}\)</span>!  Though the Stejskal and Tanner
formula is available for the classic PGSE sequence, a different sequence
may be used (e.g. TRSE on Siemens Trio), and anyway the ramps up and
down on the gradient field will not be rectangular. The Siemens scanner
software calculates the effective directional diffusion weighting of the
acquisition on the basis of the temporal profile of the applied gradient
vector field. These are in the form of the 6 <code class="docutils literal"><span class="pre">B_matrix</span></code> values
<span class="math">\([b_{xx}, b_{xy}, b_{xz}, b_{yy}, b_{yz}, b_{zz}]\)</span>.</p>
<p>In this form they are suitable for use in a least squares estimation of
the diffusion tensor via the equations across the set of acquisitions:</p>
<div class="math">
\[\log(A(\mathbf{q})/A(0)) = -(b_{xx}D_{xx} + 2b_{xy}D_{xy} + 2b_{xz}D_{xz} + \
   b_{yy}D_{yy} + 2b_{yz}D_{yz} + b_{zz}D_{zz})\]</div>
<p>The gradient field typically stays in the one gradient direction, in
this case the relationship between <span class="math">\(\mathbf{q}\)</span> and the <span class="math">\(b_{ij}\)</span> is as
follows. If we fill out the symmetric B-matrix as:</p>
<div class="math">
\[\begin{split}\mathbf{B} = \begin{pmatrix}
              b_{xx} &amp; b_{yx} &amp; b_{yz}\\
              b_{xy} &amp; b_{yy} &amp; b_{xz}\\
              b_{xz} &amp; b_{yz} &amp; b_{zz}
              \end{pmatrix}\end{split}\]</div>
<p>then <span class="math">\(\mathbf{B}\)</span> is equal to the rank 1 tensor
<span class="math">\(b\mathbf{g}\mathbf{g}^T\)</span>. One of the ways to recover <span class="math">\(b\)</span> and <span class="math">\(\mathbf{g}\)</span>,
and hence <span class="math">\(\mathbf{q}\)</span>, from
<span class="math">\(\mathbf{B}\)</span> is to do a singular value decomposition of <span class="math">\(\mathbf{B}:
\mathbf{B} = \lambda_1\mathbf{v}_1\mathbf{v}_1^T +
\lambda_2\mathbf{v}_2\mathbf{v}_2^T +
\lambda_3\mathbf{v}_3\mathbf{v}_3^T\)</span>, where only one of the <span class="math">\(\lambda_i\)</span>,
say <span class="math">\(\lambda_1\)</span>, is effectively non-zero. Then <span class="math">\(b = \lambda_1\)</span>, <span class="math">\(\mathbf{g} =
\pm\mathbf{v}_1,\)</span> and <span class="math">\(\mathbf{q} =
\pm\lambda_1\mathbf{v}_1.\)</span> The choice of sign is arbitrary
(essentially we have a choice between two possible square roots of the
rank 1 tensor <span class="math">\(\mathbf{B}\)</span>). Once we have <span class="math">\(\mathbf{q}_{actual}\)</span> we can
calculate <span class="math">\(b_{actual} = |\mathbf{q}_{actual}|\)</span> and <span class="math">\(\mathbf{g}_{actual}
= \mathbf{q}_{actual} / b_{actual}\)</span>. Various sofware packages
(e.g. FSL&#8217;s DFT-DTIFIT) expect to get 3 × N and 1 × N arrays of
<span class="math">\(\mathbf{g}_{actual}\)</span> and <span class="math">\(b_{actual}\)</span> values as their inputs.</p>
</div>


                  </div>
                </div>
              </div>

              <div class="clearer"></div>
            </div>
          </div>
          <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 sidebarCol">
    <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
      <div class="sphinxsidebarwrapper">
        <h3> Site Navigation </h3>
        <ul>
          <li><a href="../documentation.html">Documentation</a></li>
          <li><a href="../devel/index.html">Development</a></li>
        </ul>

        <h3> NIPY Community </h3>
        <ul class="simple">
          <li><a class="reference external" href="http://nipy.org/">Community Home</a></li>
          <li><a class="reference external" href="http://nipy.org/software/projects/">NIPY Projects</a></li>
          <li><a class="reference external" href="https://mail.python.org/mailman/listinfo/neuroimaging">Mailing List</a></li>
          <li><a class="reference external" href="http://nipy.org/nipy/license.html">License</a></li>
        </ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/theory/bmatrix.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
      </div>
    </div>
          </div>
        </div>
      </div>
      <footer class="footer">
        <div class="container footerContainer">
          <div class="bottomNav">
  <div class="related" role="navigation" aria-label="related navigation">
    
    <ul>
      <li class="right" style="margin-right: 10px">
        <a href="../genindex.html" title="General Index"
        accesskey="I">index</a></li>
      <li class="right" >
        <a href="../np-modindex.html" title="Python Module Index"
        >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">dipy 0.12.0dev documentation</a> &raquo;</li> 
      </ul>
    </div>
          </div>
          <div class="footerContent" role="contentinfo">
          &copy; Copyright 2008-2015, dipy developers &lt;neuroimaging@python.org&gt;.
          Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
        </div>
        </div>
      </footer>
    </body>
    </html>