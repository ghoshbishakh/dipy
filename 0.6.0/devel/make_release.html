<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Dipy &mdash; dipy 0.6.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/dipy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="dipy 0.6.0 documentation" href="../index.html" />
    <link rel="up" title="DiPy development" href="index.html" />
    <link rel="next" title="Commit message codes" href="commit_codes.html" />
    <link rel="prev" title="git resources" href="gitwash/git_resources.html" />
  <meta name="keywords" content="dipy, dMRI, DTI, DSI, diffusion MRI, Tensor,
  neuroimaging, python, neuroscience, Eleftherios, Garyfallidis, tractography,
  streamlines, fiber tracking">

  </head>
  <body role="document">
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
 <a href="../index.html">
  <img src="../_static/dipy-banner.png" alt="dipy logo"  border="0" />
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="commit_codes.html" title="Commit message codes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="gitwash/git_resources.html" title="git resources"
             accesskey="P">previous</a> |</li>
  <li><a href="../index.html">Home</a> |&nbsp;</li>
  <li><a href="../stateoftheart.html">Overview</a> |&nbsp;</li>
  <li><a href="../examples_index.html">Gallery</a> |&nbsp;</li>
  <li><a href="../installation.html">Download</a> |&nbsp;</li>
  <li><a href="../subscribe.html">Subscribe</a> |&nbsp;</li>
  <li><a href="../developers.html">Developers</a> |&nbsp;</li>
  <li><a href="../cite.html">Cite</a> &nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">DiPy development</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

  
<h4> Site Navigation </h4>
  <ul>
    <li><a href="../documentation.html">Documentation</a></li>
    <li><a href="index.html">Development</a></li>
  </ul>

<h4> NIPY Community </h4>
  <ul class="simple">
    <li><a class="reference external"
	href="http://nipy.sourceforge.net/">Community Home</a></li>
    <li><a class="reference external"
	href="http://nipy.sourceforge.net/software/projects/">NIPY Projects</a></li>
    <li><a class="reference external"
	href="http://mail.scipy.org/mailman/listinfo/nipy-devel">Mailing List</a></li>
    <li><a class="reference external"
	href="http://nipy.sourceforge.net/software/license/index.html">License</a></li>
  </ul>


  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">A guide to making a dipy release</a><ul>
<li><a class="reference internal" href="#release-tools">Release tools</a></li>
<li><a class="reference internal" href="#release-checklist">Release checklist</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="gitwash/git_resources.html"
                        title="previous chapter">git resources</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="commit_codes.html"
                        title="next chapter">Commit message codes</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/devel/make_release.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>

<div id="searchbox-ml" style="display: none">
  <h3>Search mailing list archive</h3>
  <script type="text/javascript">
    function mlsearch(curobj)
    {
    curobj.q.value="site:mail.scipy.org/pipermail/nipy-devel/ "+curobj.userquery.value
    }
  </script>
  <form action="http://www.google.com/search" method="get" onSubmit="mlsearch(this)">
    <input name="userquery" size="13" type="text" /> <input type="submit" value="Go" />
    <input name="q" type="hidden" />
  </form>
</div>
  
<div id="searchbox-site" style="display: none">
  <h3>Search this site</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="13" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    </p>
</div>
<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="a-guide-to-making-a-dipy-release">
<span id="release-guide"></span><h1>A guide to making a dipy release<a class="headerlink" href="#a-guide-to-making-a-dipy-release" title="Permalink to this headline">¶</a></h1>
<p>A guide for developers who are doing a dipy release</p>
<div class="section" id="release-tools">
<span id="id1"></span><h2>Release tools<a class="headerlink" href="#release-tools" title="Permalink to this headline">¶</a></h2>
<p>There are some release utilities that come with <a class="reference external" href="http://nipy.sourceforge.net/nibabel">nibabel</a>.  nibabel should
install these as the <code class="docutils literal"><span class="pre">nisext</span></code> package, and the testing stuff is understandably
in the <code class="docutils literal"><span class="pre">testers</span></code> module of that package.  Dipy has Makefile targets for their
use.  The relevant targets are:</p>
<div class="highlight-python"><div class="highlight"><pre>make check-version-info
make check-files
make sdist-tests
</pre></div>
</div>
<p>The first installs the code from a git archive, from the repository, and for
in-place use, and runs the <code class="docutils literal"><span class="pre">get_info()</span></code> function to confirm that installation
is working and information parameters are set correctly.</p>
<p>The second (<code class="docutils literal"><span class="pre">sdist-tests</span></code>) makes an sdist source distribution archive,
installs it to a temporary directory, and runs the tests of that install.</p>
<p>If you have a version of nibabel trunk past February 11th 2011, there will also
be a functional make target:</p>
<div class="highlight-python"><div class="highlight"><pre>make bdist-egg-tests
</pre></div>
</div>
<p>This builds an egg (which is a zip file), hatches it (unzips the egg) and runs
the tests from the resulting directory.</p>
</div>
<div class="section" id="release-checklist">
<span id="id2"></span><h2>Release checklist<a class="headerlink" href="#release-checklist" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Review the open list of <a class="reference external" href="http://github.com/nipy/dipy/issues">dipy issues</a>.  Check whether there are
outstanding issues that can be closed, and whether there are any issues that
should delay the release.  Label them !</p>
</li>
<li><p class="first">Review and update the release notes.  Review and update the <code class="file docutils literal"><span class="pre">Changelog</span></code>
file.  Get a partial list of contributors with something like:</p>
<div class="highlight-python"><div class="highlight"><pre>git log 0.5.0.. | grep &#39;^Author&#39; | cut -d&#39; &#39; -f 2- | sort | uniq
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">0.5.0</span></code> was the last release tag name.</p>
<p>Then manually go over <code class="docutils literal"><span class="pre">git</span> <span class="pre">shortlog</span> <span class="pre">0.5.0..</span></code> to make sure the release notes
are as complete as possible and that every contributor was recognized.</p>
</li>
<li><p class="first">Use the opportunity to update the <code class="docutils literal"><span class="pre">.mailmap</span></code> file if there are any duplicate
authors listed from <code class="docutils literal"><span class="pre">git</span> <span class="pre">shortlog</span> <span class="pre">-ns</span></code>.</p>
</li>
<li><p class="first">Add any new authors to the <code class="docutils literal"><span class="pre">AUTHORS</span></code> file.  Add any new entries to the
<code class="docutils literal"><span class="pre">THANKS</span></code> file.</p>
</li>
<li><p class="first">Check the copyright years in <code class="docutils literal"><span class="pre">doc/conf.py</span></code> and <code class="docutils literal"><span class="pre">LICENSE</span></code></p>
</li>
<li><p class="first">Check the <code class="docutils literal"><span class="pre">long_description</span></code> in <code class="docutils literal"><span class="pre">dipy/info.py</span></code>.  Check it matches the
<code class="docutils literal"><span class="pre">README</span></code> in the root directory, maybe with <code class="docutils literal"><span class="pre">vim</span></code> <code class="docutils literal"><span class="pre">diffthis</span></code> command.</p>
</li>
<li><p class="first">Clean and compile:</p>
<div class="highlight-python"><div class="highlight"><pre>make distclean
python setup.py build_ext --inplace
</pre></div>
</div>
</li>
<li><p class="first">Make sure all tests pass (from the dipy root directory):</p>
<div class="highlight-python"><div class="highlight"><pre>cd ..
nosetests --with-doctest dipy
cd dipy # back to the root directory
</pre></div>
</div>
</li>
<li><p class="first">Check the documentation doctests:</p>
<div class="highlight-python"><div class="highlight"><pre>cd doc
make doctest
cd ..
</pre></div>
</div>
<p>At the moment this generates lots of errors from the autodoc documentation
running the doctests in the code, where the doctests pass when run in nose -
we should find out why this is at some point, but leave it for now.</p>
</li>
<li><p class="first">Make sure all tests pass from sdist:</p>
<div class="highlight-python"><div class="highlight"><pre>make sdist-tests
</pre></div>
</div>
<p>and bdist_egg:</p>
<div class="highlight-python"><div class="highlight"><pre>make bdist-egg-tests
</pre></div>
</div>
<p>and the three ways of installing (from tarball, repo, local in repo):</p>
<div class="highlight-python"><div class="highlight"><pre>make check-version-info
</pre></div>
</div>
<p>The last may not raise any errors, but you should detect in the output
lines of this form:</p>
<div class="highlight-python"><div class="highlight"><pre>{&#39;sys_version&#39;: &#39;2.6.6 (r266:84374, Aug 31 2010, 11:00:51) \n[GCC 4.0.1 (Apple Inc. build 5493)]&#39;, &#39;commit_source&#39;: &#39;archive substitution&#39;, &#39;np_version&#39;: &#39;1.5.0&#39;, &#39;commit_hash&#39;: &#39;25b4125&#39;, &#39;pkg_path&#39;: &#39;/var/folders/jg/jgfZ12ZXHwGSFKD85xLpLk+++TI/-Tmp-/tmpGPiD3E/pylib/dipy&#39;, &#39;sys_executable&#39;: &#39;/Library/Frameworks/Python.framework/Versions/2.6/Resources/Python.app/Contents/MacOS/Python&#39;, &#39;sys_platform&#39;: &#39;darwin&#39;}
/var/folders/jg/jgfZ12ZXHwGSFKD85xLpLk+++TI/-Tmp-/tmpGPiD3E/pylib/dipy/__init__.pyc
{&#39;sys_version&#39;: &#39;2.6.6 (r266:84374, Aug 31 2010, 11:00:51) \n[GCC 4.0.1 (Apple Inc. build 5493)]&#39;, &#39;commit_source&#39;: &#39;installation&#39;, &#39;np_version&#39;: &#39;1.5.0&#39;, &#39;commit_hash&#39;: &#39;25b4125&#39;, &#39;pkg_path&#39;: &#39;/var/folders/jg/jgfZ12ZXHwGSFKD85xLpLk+++TI/-Tmp-/tmpGPiD3E/pylib/dipy&#39;, &#39;sys_executable&#39;: &#39;/Library/Frameworks/Python.framework/Versions/2.6/Resources/Python.app/Contents/MacOS/Python&#39;, &#39;sys_platform&#39;: &#39;darwin&#39;}
Files not taken across by the installation:
[]
/Users/mb312/dev_trees/dipy/dipy/__init__.pyc
{&#39;sys_version&#39;: &#39;2.6.6 (r266:84374, Aug 31 2010, 11:00:51) \n[GCC 4.0.1 (Apple Inc. build 5493)]&#39;, &#39;commit_source&#39;: &#39;repository&#39;, &#39;np_version&#39;: &#39;1.5.0&#39;, &#39;commit_hash&#39;: &#39;25b4125&#39;, &#39;pkg_path&#39;: &#39;/Users/mb312/dev_trees/dipy/dipy&#39;, &#39;sys_executable&#39;: &#39;/Library/Frameworks/Python.framework/Versions/2.6/Resources/Python.app/Contents/MacOS/Python&#39;, &#39;sys_platform&#39;: &#39;darwin&#39;}
</pre></div>
</div>
</li>
<li><p class="first">The release should now be ready.</p>
</li>
<li><p class="first">Edit <code class="file docutils literal"><span class="pre">dipy/info.py</span></code> to set <code class="docutils literal"><span class="pre">_version_extra</span></code> to <code class="docutils literal"><span class="pre">''</span></code>; commit</p>
</li>
<li><p class="first">Build the release files:</p>
<div class="highlight-python"><div class="highlight"><pre>make distclean
make source-release
</pre></div>
</div>
</li>
<li><p class="first">Once everything looks good, upload the source release to PyPi.  See
<a class="reference external" href="http://packages.python.org/an_example_pypi_project/setuptools.html">setuptools intro</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py register
python setup.py sdist --formats=gztar,zip upload
</pre></div>
</div>
</li>
<li><p class="first">Then upload the binary release for the platform you are currently on:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py bdist_egg upload
</pre></div>
</div>
</li>
<li><p class="first">Do binary builds for any virtualenvs you have:</p>
<div class="highlight-python"><div class="highlight"><pre>workon python25
python setup.py bdist_egg upload
deactivate
</pre></div>
</div>
<p>etc.  (<code class="docutils literal"><span class="pre">workon</span></code> is a virtualenvwrapper command).</p>
<p>For OSX and python 2.5 only, the installation didn&#8217;t recognize it was doing a fat (i386 + PPC)
build, and build with name <code class="docutils literal"><span class="pre">dipy-0.5.0-py2.5-macosx-10.3-i386.egg</span></code>.  I tried
to tell it to use <code class="docutils literal"><span class="pre">fat</span></code> and <code class="docutils literal"><span class="pre">universal</span></code> in the name, but uploading these
tp pypi didn&#8217;t result in in easy_install finding them.  In the end did the
standard:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py bdist_egg upload
</pre></div>
</div>
<p>which uploaded the &#8216;i386&#8217; egg, followed by:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py bdist_egg --plat-name macosx-10.3-ppc upload
</pre></div>
</div>
<p>which may or may not work to allow easy_install to find the egg for PPC.  It
does work for easy_install on my Intel machine.  I found the default platform
name with <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">bdist_egg</span> <span class="pre">--help</span></code>.</p>
<p>When trying to upload in python25, after previously saving my <code class="docutils literal"><span class="pre">~/.pypirc</span></code>
during the initial <code class="docutils literal"><span class="pre">register</span></code> step, I got a configparser error.  I found
<a class="reference external" href="http://docs.python.org/release/2.5.2/dist/pypirc.html">this python 2.5 pypirc page</a> and so hand edited
the <code class="docutils literal"><span class="pre">~/.pypirc</span></code> file to have a new section:</p>
<div class="highlight-python"><div class="highlight"><pre>[server-login]
username:my-username
password:my-password
</pre></div>
</div>
<p>after which python25 upload seemed to go smoothly.</p>
</li>
<li><p class="first">Building OSX dmgs.  This is a little complicated</p>
<p>See <a class="reference external" href="http://matthew-brett.github.com/pydagogue/develop_mac.html">MBs OSX setup</a>).</p>
<p>We have builders building the packages on the buildbots.</p>
<p>The mpkg packages will appear in <a class="reference external" href="http://nipy.bic.berkeley.edu/dipy-dist">http://nipy.bic.berkeley.edu/dipy-dist</a></p>
<p>The problem is that the buildbots built the packages as the <code class="docutils literal"><span class="pre">buildslave</span></code>
user, but we need to make files have root permissions when installed from the
installer.</p>
<p>This can be done using a script <code class="docutils literal"><span class="pre">reown_mpkg</span></code> that is part of the development
version of <code class="docutils literal"><span class="pre">bdist_mpkg</span></code> : <a class="reference external" href="https://github.com/matthew-brett/bdist_mpkg">https://github.com/matthew-brett/bdist_mpkg</a></p>
<p>Install the development version, and then you can build correct installers
with something like the following (on a machine to which you have <code class="docutils literal"><span class="pre">sudo</span></code>
permission):</p>
<div class="highlight-python"><div class="highlight"><pre>mkdir mpkgs
cd mpkgs/
scp -r buildbot-master:nibotmi/public_html/dipy-dist/*.mpkg .
sudo reown_mpkg dipy-0.6.0.dev-py2.6-macosx10.6.mpkg root admin
sudo reown_mpkg dipy-0.6.0.dev-py2.7-macosx10.6.mpkg root admin
zip -r dipy-0.6.0.dev-py2.6-macosx10.6.mpkg.zip dipy-0.6.0.dev-py2.6-macosx10.6.mpkg
zip -r dipy-0.6.0.dev-py2.7-macosx10.6.mpkg.zip dipy-0.6.0.dev-py2.7-macosx10.6.mpkg
</pre></div>
</div>
</li>
<li><p class="first">Windows <code class="docutils literal"><span class="pre">.exe</span></code> installers should arrive in the same directory as the mpkg
builds.  You may need to trigger the relevant builders from the buildbot web
interface.  You should be able to download them and then upload them to pypi.</p>
<p>If not, the manual way is something like:</p>
<div class="highlight-python"><div class="highlight"><pre>make distclean
c:\Python26\python.exe setup.py bdist_egg upload
c:\Python26\python.exe setup.py bdist_wininst --target-version=2.6 register upload
</pre></div>
</div>
<p>Maybe virtualenvs for the different versions of python?  I haven&#8217;t explored
that yet.</p>
</li>
<li><p class="first">Tag the release with tag of form <code class="docutils literal"><span class="pre">0.5.0</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>git tag -am &#39;First public release&#39; 0.5.0
</pre></div>
</div>
</li>
<li><p class="first">Now the version number is OK, push the docs to sourceforge with:</p>
<div class="highlight-python"><div class="highlight"><pre>make upload-website-mysfusername
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">mysfusername</span></code> is obviously your own sourceforge username.</p>
</li>
<li><p class="first">Set up maintenance / development branches</p>
<p>If this is this is a full release you need to set up two branches, one for
further substantial development (often called &#8216;trunk&#8217;) and another for
maintenance releases.</p>
<ul>
<li><p class="first">Branch to maintainance:</p>
<div class="highlight-python"><div class="highlight"><pre>git co -b maint/0.5.x
</pre></div>
</div>
<p>Set <code class="docutils literal"><span class="pre">_version_extra</span></code> back to <code class="docutils literal"><span class="pre">.dev</span></code> and bump <code class="docutils literal"><span class="pre">_version_micro</span></code> by 1.
Thus the maintenance series will have version numbers like - say - &#8216;0.5.1.dev&#8217;
until the next maintenance release - say &#8216;0.5.1&#8217;.  Commit.</p>
</li>
<li><p class="first">Start next development series:</p>
<div class="highlight-python"><div class="highlight"><pre>git co main-master
</pre></div>
</div>
<p>then restore <code class="docutils literal"><span class="pre">.dev</span></code> to <code class="docutils literal"><span class="pre">_version_extra</span></code>, and bump <code class="docutils literal"><span class="pre">_version_minor</span></code> by 1.
Thus the development series (&#8216;trunk&#8217;) will have a version number here of
&#8216;0.6.0.dev&#8217; and the next full release will be &#8216;0.6.0&#8217;.</p>
</li>
</ul>
<p>If this is just a maintenance release from <code class="docutils literal"><span class="pre">maint/0.5.x</span></code> or similar, just
tag and set the version number to - say - <code class="docutils literal"><span class="pre">0.5.2.dev</span></code>.</p>
</li>
<li><p class="first">Make a tarball for the examples, to allow packagers to bypass the need for
having vtk or pytables or a display on the build machines:</p>
<div class="highlight-python"><div class="highlight"><pre>cd doc
make upload-examples-mysfusername
</pre></div>
</div>
<p>The command requires <a class="reference external" href="http://www.pytables.org">pytables</a> and python vtk on your machine. It writes an
archive named for the dipy version and the docs, e.g:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;dipy root&gt;/dist/dipy-0.5.0.dev-doc-examples.tar.gz
</pre></div>
</div>
<p>and thence writes the archive to the dipy doc directory on sourceforge.</p>
</li>
<li><p class="first">Announce to the mailing lists.  With fear and trembling.</p>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="commit_codes.html" title="Commit message codes"
             >next</a> |</li>
        <li class="right" >
          <a href="gitwash/git_resources.html" title="git resources"
             >previous</a> |</li>
  <li><a href="../index.html">Home</a> |&nbsp;</li>
  <li><a href="../stateoftheart.html">Overview</a> |&nbsp;</li>
  <li><a href="../examples_index.html">Gallery</a> |&nbsp;</li>
  <li><a href="../installation.html">Download</a> |&nbsp;</li>
  <li><a href="../subscribe.html">Subscribe</a> |&nbsp;</li>
  <li><a href="../developers.html">Developers</a> |&nbsp;</li>
  <li><a href="../cite.html">Cite</a> &nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >DiPy development</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2008-2013, dipy developers &lt;nipy-devel@neuroimaging.scipy.org&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>